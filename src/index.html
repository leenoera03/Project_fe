<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Pameran Lukisan Online</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      min-height: 100vh;
      color: #333;
    }

    /* Header */
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 15px 0;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      font-size: 24px;
      font-weight: 700;
      color: #667eea;
    }

    .logo::before {
      content: 'üé®';
      margin-right: 10px;
      font-size: 28px;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 16px;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 25px;
      font-size: 14px;
      font-weight: 500;
    }

    .user-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
    }

    .logout-btn, #logoutBtn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
      font-size: 14px;
      font-family: inherit;
    }

    .logout-btn:hover, #logoutBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    /* Main Content */
    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .hero-section {
      text-align: center;
      margin-bottom: 50px;
      color: white;
    }

    .hero-section h1 {
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 15px;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .hero-section p {
      font-size: 18px;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* Search Section */
    .search-section {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 50px 0;
      gap: 20px;
    }

    .search-container {
      position: relative;
      max-width: 500px;
      width: 100%;
    }

    .search-input {
      width: 100%;
      padding: 15px 50px 15px 20px;
      border: none;
      border-radius: 25px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      font-size: 16px;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);
      transform: translateY(-2px);
    }

    .search-input::placeholder {
      color: #999;
    }

    .search-btn {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      background: linear-gradient(135deg, #667eea, #764ba2);
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .search-btn:hover {
      transform: translateY(-50%) scale(1.1);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .filter-btn {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: none;
      padding: 15px 25px;
      border-radius: 25px;
      color: #667eea;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      font-family: inherit;
    }

    .filter-btn:hover {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      transform: translateY(-2px);
    }

    /* Section Headers */
    .section {
      margin-bottom: 60px;
    }

    .section-header {
      text-align: center;
      margin-bottom: 40px;
      color: white;
    }

    .section-header h2 {
      font-size: 36px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .section-header p {
      font-size: 16px;
      opacity: 0.8;
    }

    /* Gallery Styles */
    .gallery, #listLukisan {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 30px;
      margin-top: 40px;
      align-items: start;
    }

    .gallery-item {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      transition: all 0.4s ease;
      backdrop-filter: blur(10px);
      cursor: pointer;
      position: relative;
      break-inside: avoid;
    }

    .gallery-item:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
    }

    .gallery-item:nth-child(odd) {
      transform: rotate(-0.5deg);
    }

    .gallery-item:nth-child(even) {
      transform: rotate(0.5deg);
    }

    .gallery-item:nth-child(3n) {
      transform: rotate(-0.3deg);
    }

    .gallery-item:hover {
      transform: translateY(-8px) scale(1.02) rotate(0deg) !important;
      z-index: 10;
    }

    .gallery-item img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      display: block;
    }

    .gallery-item .caption {
      padding: 20px;
      background: white;
      font-weight: 500;
      color: #333;
      text-align: center;
      font-size: 16px;
      border-top: 3px solid #667eea;
    }

    .like-icon {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255, 255, 255, 0.9);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #bbb;
      font-size: 18px;
      cursor: pointer;
      z-index: 5;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .like-icon:hover {
      background: rgba(255, 255, 255, 1);
      transform: scale(1.1);
      color: #ff6b6b;
    }

    /* Modal Styles */
    .modal, #artModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal.active, #artModal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .modal-content img, #modal-img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 20px 20px 0 0;
    }

    .close-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      color: #333;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s ease;
      z-index: 10;
      font-weight: bold;
    }

    .close-btn:hover {
      background: rgba(255, 255, 255, 1);
    }

    .modal-content h2, #modal-title {
      font-size: 28px;
      font-weight: 700;
      color: #333;
      margin: 20px 30px 10px;
    }

    .modal-content p {
      margin: 10px 30px;
      color: #666;
      line-height: 1.6;
    }

    .modal-content p strong {
      color: #667eea;
    }

    #modal-description {
      background: #f8f9fa;
      padding: 20px;
      margin: 20px 30px;
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }

    /* Comments Section */
    #komentarSection {
      margin: 30px;
      margin-top: 20px;
    }

    #komentarSection h4 {
      font-size: 20px;
      font-weight: 600;
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }

    #formKomentar {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      display: flex;
      gap: 10px;
    }

    #modalInputKomentar {
      flex: 1;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-family: inherit;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }

    #modalInputKomentar:focus {
      outline: none;
      border-color: #667eea;
    }

    #formKomentar button {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    #formKomentar button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    #modalKomentarList {
      space-y: 15px;
    }

    .comment-item {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      transition: box-shadow 0.3s ease;
    }

    .comment-item:hover {
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .comment-author {
      font-weight: 600;
      color: #667eea;
      margin-bottom: 5px;
    }

    .comment-date {
      font-size: 12px;
      color: #999;
      margin-bottom: 10px;
    }

    .comment-text {
      line-height: 1.5;
      color: #555;
    }

    /* Edit and Delete buttons */
    button {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(8px);
      border: none;
      padding: 8px 15px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      color: #667eea;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-right: 10px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    /* Edit button style */
    button:nth-child(1) {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
    }

    button:nth-child(1):hover {
      background: #667eea;
      color: white;
    }

    /* Delete button style */
    button:nth-child(2) {
      background: rgba(255, 107, 107, 0.1);
      color: #ff6b6b;
    }

    button:nth-child(2):hover {
      background: #ff6b6b;
      color: white;
    }

  </style>
</head>

<body>
  <!-- Header -->
<header class="header">
    <div class="header-content">
      <div class="logo">
        <span>Maya Lukisan</span>
      </div>
      <div class="user-menu">
        <div class="user-info">
          <div class="user-avatar">U</div>
          <span id="welcomeText">User</span>
        </div>
        <button class="logout-btn" id="logoutBtn">Logout</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Hero Section -->
    <section class="hero-section">
      <h1>Pameran Lukisan Online</h1>
      <p>Lukisan mengenalkan lukisan populer dari para seniman dunia.</p>
    </section>

    <!-- Search Section -->
    <section class="search-section">
      <div class="search-container">
        <input 
          type="text" 
          class="search-input" 
          id="searchInput"
          placeholder="Cari lukisan atau seniman..."
        />
        <button class="search-btn">üîç</button>
      </div>
      <button class="filter-btn">Filter</button>
    </section>

    <!-- Gallery Section -->
    <section class="section">
      <div class="section-header">
        <h2>Galeri Lukisan</h2>
        <p>Lukisan populer dunia yang perlu anda ketahui.</p>
      </div>
      
      <section class="gallery" id="listLukisan">
        <!-- Lukisan dari API akan masuk sini -->
      </section>
    </section>
  </main>

  <!-- Modal -->
  <div class="modal" id="artModal">
    <div class="modal-content">
      <button class="close-btn">&times;</button>
      <img id="modal-img" src="" alt="Lukisan" />
      <h2 id="modal-title"></h2>
      <p><strong>Seniman:</strong> <span id="modal-artist"></span></p>
      <p><strong>Tahun:</strong> <span id="modal-year"></span></p>
      <p id="modal-description"></p>

      <div id="komentarSection">
        <h4>üí¨ Komentar</h4>
        <form id="formKomentar">
          <input
            type="text"
            id="modalInputKomentar"
            placeholder="Tulis komentar Anda..."
            required
          />
          <button type="submit">Kirim</button>
        </form>
        <div id="modalKomentarList">
      
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "https://tcc-be-836058602525.us-central1.run.app";
    let token = null;
    let currentLukisanId = null;

    // Initialize and check login
    function initApp() {
      token = localStorage.getItem("token");
      if (!token || !token.includes('.')) {
        alert("Silakan login terlebih dahulu.");
        localStorage.removeItem("token");
        window.location.href = "login.html";
        return;
      }

      try {
        const tokenPayload = JSON.parse(atob(token.split('.')[1]));
        const username = tokenPayload.username || tokenPayload.name || tokenPayload.email || "User";
        document.getElementById("welcomeText").innerText = username;
      } catch (e) {
        console.error("Token parsing error", e);
      }

      fetchLukisan();
    }

    async function fetchLukisan() {
      try {
        const res = await fetch(`${API_URL}/lukisan`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        
        if (res.status === 401) {
          alert("Sesi login habis. Silakan login ulang.");
          localStorage.removeItem("token");
          window.location.href = "login.html";
          return;
        }
        
        const lukisanList = await res.json();
        renderGallery(lukisanList);
      } catch (err) {
        console.error("Error fetching lukisan:", err);
        document.getElementById("listLukisan").innerHTML =
          "<p style='color:white; text-align:center;'>Gagal memuat data lukisan.</p>";
      }
    }

    // Render galeri
    function renderGallery(lukisanList) {
      const container = document.getElementById("listLukisan");
      container.innerHTML = "";
      
      lukisanList.forEach((lukisan, idx) => {
        const div = document.createElement("div");
        div.classList.add("gallery-item");
        div.style.opacity = "0";
        div.style.transform = "translateY(30px)";
        div.style.transition = "opacity 0.6s ease, transform 0.6s ease";
        
        setTimeout(() => {
          div.style.opacity = "1";
          div.style.transform = "translateY(0)";
        }, idx * 100);

        // Gunakan properti yang benar dari response API
        const imageUrl = lukisan.image_url || lukisan.gambar || '';
        const title = lukisan.title || lukisan.judul || 'Untitled';
        const artist = lukisan.artist_display || lukisan.seniman || 'Unknown Artist';
        const description = lukisan.deskripsi || '';
        const year = lukisan.date_display || lukisan.tahun || '';
        const id = lukisan.id;

        div.innerHTML = `
          <div class="like-icon" onclick="event.stopPropagation(); toggleLike(this)"><i class="fa-regular fa-heart"></i></div>
          <img src="${imageUrl}" alt="${title}" onerror="this.src='https://via.placeholder.com/300x250?text=Image+Not+Found'" />
          <div class="caption">${title} ‚Äì ${artist}</div>
        `;

        // Event click untuk membuka modal
        div.onclick = function () {
          showModal(imageUrl, title, artist, description, year, id);
        };

        container.appendChild(div);
      });
    }

    // Tampilkan modal - PERBAIKAN: tambahkan parameter id
    function showModal(img, title, artist, desc, year, id) {
      currentLukisanId = id; // Set current lukisan ID
      console.log("Opening modal for lukisan ID:", currentLukisanId); // Debug log
      
      document.getElementById("modal-img").src = img;
      document.getElementById("modal-title").innerText = title;
      document.getElementById("modal-artist").innerText = artist;
      document.getElementById("modal-description").innerText = desc || 'Tidak ada deskripsi.';
      document.getElementById("modal-year").innerText = year || 'Tahun tidak diketahui';
      document.getElementById("artModal").style.display = "flex";
      
      // Load comments for this artwork
      loadComments();
    }

    // Tutup modal
    function closeModal() {
      document.getElementById("artModal").style.display = "none";
      currentLukisanId = null; // Reset current lukisan ID
    }

    // Load comments - PERBAIKAN: pastikan currentLukisanId ada
    async function loadComments() {
      if (!currentLukisanId) {
        console.error("No lukisan ID set");
        return;
      }

      try {
        console.log("Loading comments for lukisan ID:", currentLukisanId); // Debug log
        
        const res = await fetch(`${API_URL}/komentar?lukisanId=${currentLukisanId}`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        
        const comments = await res.json();
        console.log("Loaded comments:", comments); // Debug log
        
        renderComments(comments);
      } catch (err) {
        console.error("Gagal load komentar:", err);
        document.getElementById("modalKomentarList").innerHTML = 
          '<p style="color: red; text-align: center;">Gagal memuat komentar.</p>';
      }
    }

    // Render comments
    function renderComments(comments) {
      const container = document.getElementById("modalKomentarList");
      container.innerHTML = "";
      
      if (!Array.isArray(comments) || comments.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999;">Belum ada komentar.</p>';
        return;
      }
      
      comments.forEach(comment => {
        const commentDiv = document.createElement("div");
        commentDiv.classList.add("comment-item");
        
        const date = new Date(comment.tanggal || comment.created_at).toLocaleDateString('id-ID');
        
        commentDiv.innerHTML = `
          <div class="comment-author">${comment.username || 'email'}</div>
          <div class="comment-text">${comment.isi || comment.content}</div>
          <div class="comment-date">${date}</div>
          <button onclick="editComment(${comment.id})">Edit</button>
          <button onclick="deleteComment(${comment.id})">Delete</button>
        `;
        
        container.appendChild(commentDiv);
      });
    }

    // Edit comment
    function editComment(commentId) {
      const newComment = prompt("Edit your comment:");

      if (newComment && newComment.trim()) {
        updateComment(commentId, newComment.trim());
      }
    }

    // Update comment
    async function updateComment(commentId, newComment) {
      try {
        const response = await fetch(`${API_URL}/komentar/${commentId}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`,
          },
          body: JSON.stringify({ isi: newComment }),
        });

        if (response.status === 401) {
          alert("‚ö†Ô∏è Sesi login habis. Silakan login ulang.");
          localStorage.removeItem("token");
          window.location.href = "login.html";
          return;
        }

        if (!response.ok) {
          const errorData = await response.json();
          alert(`‚ö†Ô∏è Error: ${errorData.message}`);
          return;
        }

        alert("‚úÖ Komentar berhasil diperbarui!");
        loadComments(); // Reload comments
      } catch (err) {
        console.error("Gagal memperbarui komentar:", err);
      }
    }

    // Delete comment
    async function deleteComment(commentId) {
      if (confirm("Apakah Anda yakin ingin menghapus komentar ini?")) {
        try {
          const response = await fetch(`${API_URL}/komentar/${commentId}`, {
            method: "DELETE",
            headers: { Authorization: `Bearer ${token}` },
          });

          if (response.status === 401) {
            alert("‚ö†Ô∏è Sesi login habis. Silakan login ulang.");
            localStorage.removeItem("token");
            window.location.href = "login.html";
            return;
          }

          if (!response.ok) {
            const errorData = await response.json();
            alert(`‚ö†Ô∏è Error: ${errorData.message}`);
            return;
          }

          alert("‚úÖ Komentar berhasil dihapus!");
          loadComments(); // Reload comments
        } catch (err) {
          console.error("Gagal menghapus komentar:", err);
        }
      }
    }

    // Add comment - PERBAIKAN: pastikan semua data terisi
    async function addComment() {
      const commentInputEl = document.getElementById("modalInputKomentar");
      const commentInput = commentInputEl.value.trim();

      if (!commentInput) {
        alert("‚ö†Ô∏è Harap isi kolom komentar!");
        return;
      }
      
      if (!currentLukisanId) {
        alert("‚ö†Ô∏è Tidak ada lukisan yang dipilih.");
        console.error("currentLukisanId is null or undefined");
        return;
      }

      // Check if token exists and is valid
      if (!token) {
        alert("‚ö†Ô∏è Token tidak ditemukan. Silakan login ulang.");
        localStorage.removeItem("token");
        window.location.href = "login.html";
        return;
      }

      try {
        console.log("Token being used:", token); // Debug log
        console.log("Sending comment:", { isi: commentInput, lukisanId: currentLukisanId }); // Debug log
        
        const response = await fetch(`${API_URL}/komentar`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`,
          },
          body: JSON.stringify({
            isi: commentInput,
            lukisanId: currentLukisanId
          }),
        });

        console.log("Response status:", response.status); // Debug log
        console.log("Response headers:", Object.fromEntries(response.headers.entries())); // Debug log
        
        // Try to get response text for debugging
        const responseText = await response.clone().text();
        console.log("Response body:", responseText);

        // Handle different error status codes
        if (response.status === 401) {
          alert("‚ö†Ô∏è Sesi login habis. Silakan login ulang.");
          localStorage.removeItem("token");
          window.location.href = "login.html";
          return;
        }

        if (response.status === 403) {
          // Try to get error details
          let errorDetails = "";
          try {
            const errorData = await response.json();
            errorDetails = errorData.error || errorData.message || "";
            console.log("403 Error details:", errorData);
          } catch (e) {
            console.log("Could not parse 403 error response");
          }
          
          alert(`‚ö†Ô∏è Error 403: Tidak memiliki izin untuk mengirim komentar.\nDetail: ${errorDetails}\n\nSilakan login ulang.`);
          console.error("403 Forbidden - Possible causes:", {
            token: token ? "exists" : "missing",
            tokenLength: token ? token.length : 0,
            lukisanId: currentLukisanId,
            endpoint: `${API_URL}/komentar`
          });
          return; // Don't redirect immediately, let user see the error
        }

        if (!response.ok) {
          let errorMessage = "Gagal mengirim komentar";
          try {
            const errorData = await response.json();
            errorMessage = errorData.error || errorData.message || errorMessage;
          } catch (e) {
            console.error("Could not parse error response:", e);
          }
          throw new Error(errorMessage);
        }

        const result = await response.json();
        console.log("Comment added successfully:", result); // Debug log
        
        // Clear input and reload comments
        commentInputEl.value = "";
        loadComments();
        
        // Show success message
        alert("‚úÖ Komentar berhasil ditambahkan!");
        
      } catch(err) {
        console.error("Komentar gagal:", err);
        
        // More specific error messages
        if (err.message.includes("fetch")) {
          alert("‚ùå Gagal terhubung ke server. Pastikan server backend berjalan.");
        } else {
          alert("‚ùå Gagal mengirim komentar: " + err.message);
        }
      }
    }

    // Event listener form komentar
    document.getElementById("formKomentar").addEventListener("submit", (e) => {
      e.preventDefault();
      addComment();
    });

    // Toggle like
    function toggleLike(el) {
      const icon = el.querySelector("i");
      if (icon.classList.contains("fa-regular")) {
        icon.classList.remove("fa-regular");
        icon.classList.add("fa-solid");
        el.style.color = "red";
      } else {
        icon.classList.remove("fa-solid");
        icon.classList.add("fa-regular");
        el.style.color = "#bbb";
      }
    }

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      if (confirm("Apakah Anda yakin ingin logout?")) {
        localStorage.removeItem("token");
        window.location.href = "login.html";
      }
    });

    // Close modal when clicking outside
    document.getElementById("artModal").addEventListener("click", (e) => {
      if (e.target === document.getElementById("artModal")) {
        closeModal();
      }
    });
    // Tutup modal saat klik tombol close (√ó)
    document.querySelector(".close-btn").addEventListener("click", closeModal);

    initApp();
  </script>
</body>

</html>
